---
- name: configure interfaces
  hosts: vyos
  connection: network_cli
  tasks:

    - name: enable SSH
      vyos.vyos.vyos_config:
        lines:
          - set service ssh port '22'
          - set service ssh disable-password-authentication
          - set service ssh loglevel info
          - set service ssh dynamic-protection
          - set service ssh dynamic-protection detect-time 3600

    - name: configure interfaces L2 settings
      vyos.vyos.vyos_config:
        lines:
          - set interfaces ethernet {{ item.name }} hw-id '{{ item.mac }}'
          - set interfaces ethernet {{ item.name }} description '{{ item.description }}'
          - set interfaces ethernet {{ item.name }} mtu '{{ item.mtu }}'
      loop: "{{ vyos_interfaces }}"

    - name: configure interfaces L3 settings
      vyos.vyos.vyos_l3_interfaces:
        config:
        - name: "{{ item.name }}"
          ipv4:
          - address: "{{ item.addresse }}"
        state: merged
      loop: "{{ vyos_interfaces }}"
